{% extends "base.html" %}

{% block scripts %}
{{ super() }}
{{ include_js(['marked', 'moment']) }}

{% if user.about %}
<script type="text/javascript">
    options = {
        sanitize: true
    }

    var about_user = document.getElementById('about_user')
    about_user.innerHTML = marked(about_user.innerHTML, options);
</script>

{% endif %}
{% endblock %}

{% block app_content %}

    <h1>User profile for {{ user.username }}</h1>
    {% if user == current_user or current_user.has_admin_role() %}
    <ul class="nav nav-tabs">
        <li>
            <a href="{{ url_for('user.edit', username=user.username) }}">
                <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                Edit profile
            </a>
        </li>

        {% if user == current_user  %}
        <li>
            <a href="{{ url_for('user.settings') }}">
                <span class="glyphicon glyphicon-cog"></span>
                Settings
            </a>
        </li>
        <li>
            <a href="{{ url_for('character.create') }}">
                <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                New character
            </a>
        </li>
        {% endif %}
    </ul>
    {% endif %}

    {% if user.about %}
    <h2>About</h2>
    <p id="about_user" class="custom-markdown">
{{ user.about }}
    </p>
    {% else %}
    <p>No description given.</p>
    {% endif %}

    {% if user == current_user or user.characters %}
    <h2>Characters</h2>
    {% endif %}

    {% if user.characters %}
    <table class="table table-hover table-striped">
        <thead>
            <tr>
                <th>Character</th>
                <th>Actions</th>
            </tr>
        </thead>

        <tbody>
        {% for char in user.characters %}
            <tr>
                <td> {{ char.name }} ({{ char.race}} {{ char.class_ }})</td>
                <td>
                    <a href="{{ url_for('character.view', id=char.id) }}" class="btn btn-default">
                        <span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span>
                        View
                    </a>

                    {% if user == current_user %}
                    <a href="{{ url_for('character.edit', id=char.id) }}" class="btn btn-default">
                        <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                        Edit
                    </a>
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    {% endif %}

    {% if current_user.has_admin_role() %}
    <h2>Roles</h2>

    {% if user.roles %}
    <dl class="dl-horizontal">
        {% if user.id == 1 and user.username == "Tar" %}
        <dt>The Creator</dt>
        <dd></dd>
        {% endif %}

        {% if user.id == 1 %}
        <dt>Eternal admin</dt>
        <dd>original admin account; can't have his admin privilege removed</dd>
        {% endif %}

        {% for role in user.roles %}
        <dt>{{ role.name }}</dt>
        <dd>{{ role.description }}</dd>
        {% endfor %}
    </dl>
    {% else %}
    <p>User has no special roles.</p>
    {% endif %}

    <hr>
    <p>
        Created: {{ moment(user.created).format(current_user.dateformat) }} <br />
        Last seen: {{ moment(user.last_seen).format(current_user.dateformat) }}
    </p>
    {% endif %}

{% endblock %}