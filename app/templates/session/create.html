{% extends "base.html" %}
{% import 'bootstrap/wtf.html' as wtf %}

{% block styles %}
{{ super() }}
{{ include_css(['simplemde', 'multi-select', 'bootstrap-datetimepicker']) }}
{% endblock %}

{% block scripts %}
{{ super() }}
{{ include_js(['simplemde', 'multi-select', 'bootstrap-datetimepicker', 'moment', 'quicksearch']) }}

<script>
{% include "simplemde.js" %}
var simplemde = new SimpleMDE(generateSMDEConfig("summary"));

var simplemde = new SimpleMDE(generateSMDEConfig("dm_notes"));

var filter = $('<input type="text" class="search-filter" autocomplete="off" placeholder="filter" id="participants-filter">')

filter.insertAfter("label[for=participants]");

$("#participants").multiSelect({
    keepOrder: true,
    selectableHeader: "Available",
    selectionHeader: "Participants",
    cssClass: "partymember-select",
    selectableOptgroup: true,
    afterInit: function(ms){
        var searchString = '#' + this.$container.attr('id')+' .ms-elem-selectable:not(.ms-selected)'
        searchString += ', #' + this.$container.attr('id')+' .ms-elem-selection.ms-selected';
        this.filt = filter.quicksearch(searchString)
    },
    afterSelect: function(){
        this.filt.cache();
    },
    afterDeselect: function(){
        this.filt.cache();
    }
});

moment.updateLocale('en', {
    week: { dow: 1 }
});

$("#date").wrap('<div class="input-group date" id="datetimepicker"></div>');
iga = $("<span/>").addClass("input-group-addon");
$("<span/>").addClass("glyphicon glyphicon-calendar").appendTo(iga);
iga.appendTo($("#datetimepicker"));

var dateformat_string = "YYYY-MM-DD HH:mm"

$(function() {
    $("#datetimepicker").datetimepicker({
        format: dateformat_string
    })
});

$("form").submit(function(e) {
    d = $("#date").val();
    utc_d = moment(d).utc().format(dateformat_string);
    $("#date").val(utc_d);
});
</script>
{% endblock %}

{% block app_content %}
    <h1>Create new session</h1>

    {{ wtf.quick_form(form) }}
{% endblock %}