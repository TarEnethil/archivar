{% extends "base.html" %}

{% block scripts %}
{{ super() }}
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

{{ moment.include_moment() }}

{% if session.summary or (session.dm_notes and current_user.has_admin_role()) %}
<script type="text/javascript">
    options = {
        sanitize: true
    }

    {% if session.summary %}
    var summary_ = document.getElementById('summary')
    summary_.innerHTML = marked(summary_.innerHTML, options);
    {% endif %}

    {% if session.dm_notes and current_user.has_admin_role() %}
    var dm_notes = document.getElementById('session_dm_notes')
    dm_notes.innerHTML = marked(dm_notes.innerHTML, options);
    {% endif %}
</script>

{% endif %}
{% endblock %}

{% block app_content %}
<h1>{{ session.title }} ({{ moment(session.date).format(current_user.dateformat) }})</h1>

<ul class="nav nav-tabs">
{% if prev %}
    <li>
        <a href="{{ url_for('session.view', id=prev) }}">
            <span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span>
            Previous session
        </a>
    </li>
{% endif %}

{% if current_user.has_admin_role() %}
    <li>
        <a href="{{ url_for('session.edit', id=session.id) }}">
            <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
            Edit session
        </a>
    </li>
{% endif %}

{% if next %}
    <li>
        <a href="{{ url_for('session.view', id=next) }}">
            <span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span>
            Next session
        </a>
    </li>
{% endif %}
</ul>

<h2>Summary</h2>
{% if session.summary %}
    {% if current_user.phb_session %}
    <div id="summary" class="custom-markdown phb-style">
    {% else %}
    <div id="summary" class="custom-markdown">
    {% endif %}
{{ session.summary }}
    </div>
{% else %}
<p>No summary.</p>
{% endif %}

{% if current_user.has_admin_role() %}
    {% if session.dm_notes %}
    <hr>
    <h2>DM Notes</h2>
    <p id="session_dm_notes" class="custom-markdown">
{{ session.dm_notes }}
        </p>
    {% endif %}
{% endif %}

<h2>Participants</h2>
{% if session.participants %}
<ul class="list-unstyled">
    {% for member in session.participants %}
    <li>
        {% if member.player.id == current_user.id %}
        <a href="{{ url_for('character.view', id=member.id) }}"><b>{{ member.name }}</b></a>
        {% else %}
        <a href="{{ url_for('character.view', id=member.id) }}">{{ member.name }}</a>
        {% endif %}
    </li>
    {% endfor %}
</ul>
{% else %}
<p>No participants.</p>
{% endif %}
{% endblock %}