{% extends "base.html" %}

{% block scripts %}
{{ super() }}
{{ include_js(['marked', 'moment']) }}

<script type="text/javascript">
    options = {
        sanitize: true
    }

    {% if char.description %}
    var char_desc = document.getElementById('char_description')
    char_desc.innerHTML = marked(char_desc.innerHTML, options);
    {% endif %}

    {% if char.private_notes and (current_user.has_admin_role() or char.player.id == current_user.id) %}
    var priv_notes = document.getElementById('char_private_notes')
    priv_notes.innerHTML = marked(priv_notes.innerHTML, options);
    {% endif %}

    {% if char.dm_notes and current_user.has_admin_role() %}
    var dm_notes = document.getElementById('char_dm_notes')
    dm_notes.innerHTML = marked(dm_notes.innerHTML, options);
    {% endif %}

    {% if char.player.id == current_user.id or current_user.has_admin_role() %}
    $(document).ready(function() {
        $("#delete-link").click(function(e) {
            var p = confirm("Are you sure you want to delete '{{ char.name }}'?");

            if (!p) {
                e.preventDefault();
            }
        });
    });
    {% endif %}
</script>
{% endblock %}

{% block app_content %}

    <h1>{{ char.name }}</h1>
    {% if char.player == current_user or current_user.has_admin_role() %}
    <ul class="nav nav-tabs">
        <li>
            <a href="{{ url_for('character.edit', id=char.id) }}">
                <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                Edit character
            </a>
        </li>
        <li>
            <a href="{{ url_for('character.delete', id=char.id) }}" class="nav-danger" id="delete-link">
                <span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span>
                Delete
            </a>
        </li>
    </ul>
    {% endif %}

    <h2>Info</h2>

     <dl class="dl-horizontal">
        <dt>Name</dt>
        <dd>{{ char.name }}</dd>
        <dt>Race</dt>
        <dd>{{ char.race }}</dd>
        <dt>Class</dt>
        <dd>{{ char.class_ }}</dd>
        <dt>Player</dt>
        <dd><a href="{{ url_for('user.profile', username=char.player.username) }}">{{ char.player.username }}</a></dd>
        {% if char.sessions %}
            <dt>Sessions</dt>
            <dd>{{ char.sessions|length }}</dd>
        {% endif %}
    </dl>

    {% if char.parties %}
    <h3>Parties</h3>

    <ul>
        {% for party in char.parties %}
        <li>
            <a href="{{ url_for('party.view', id=party.id) }}">{{ party.name }}</a>
        </li>
        {% endfor %}
    </ul>
    {% else %}
    <p>Character is in no parties.</p>
    {% endif %}

    {% if char.description %}
    {% if current_user.phb_character %}
    <p id="char_description" class="custom-markdown phb-style">
    {% else %}
    <p id="char_description" class="custom-markdown">
    {% endif %}
{{ char.description }}
    </p>
    {% endif %}

    {% if char.private_notes and (current_user.has_admin_role() or char.player.id == current_user.id) %}
    <hr>
    <h2>Private Notes</h2>
    <p id="char_private_notes" class="custom-markdown">
{{ char.private_notes }}
    </p>
    {% endif %}

    {% if current_user.has_admin_role() %}
        {% if char.dm_notes %}
        <hr>
        <h2>DM Notes</h2>
        <p id="char_dm_notes" class="custom-markdown">
{{ char.dm_notes }}
        </p>
        {% endif %}

    <hr>
    <p>
        Created: {{ moment(char.created).format(current_user.dateformat) }} <br />
        Edited: {{ moment(char.edited).format(current_user.dateformat) }}
    </p>
    {% endif %}

{% endblock %}