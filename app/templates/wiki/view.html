{% extends "wiki/base.html" %}

{% block scripts %}
{{ super() }}
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

{% if entry.content or (entry.dm_content and current_user.has_admin_role()) %}
<script type="text/javascript">
    options = {
        sanitize: true
    }

    {% if entry.content %}
    var content = document.getElementById('content')
    content.innerHTML = marked(content.innerHTML, options);
    {% endif %}

    {% if entry.dm_content and current_user.has_admin_role() %}
    var dm_content = document.getElementById('entry_dm_content')
    dm_content.innerHTML = marked(dm_content.innerHTML, options);
    {% endif %}
</script>
{% endif %}
{% endblock %}

{% block app_content %}
{{ super() }}

<a href="{{ url_for('wiki.create') }}" class="btn btn-default">
    <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
    New
</a>
<a href="{{ url_for('wiki.edit', id=entry.id) }}" class="btn btn-default">
    <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
    Edit
</a>

<h1>{{ entry.title }} </h1>

{% if entry.content %}
    <div id="content" class="custom-markdown">
{{ entry.content }}
    </div>
{% else %}
<p>No content.</p>
{% endif %}

{% if current_user.has_admin_role() %}
    {% if entry.dm_content %}
    <hr>
    <h2>DM Notes</h2>
    <p id="entry_dm_content" class="custom-markdown">
{{ entry.dm_content }}
    </p>
    {% endif %}
{% endif %}

{% if entry.tags %}
<p>{{ entry.tags }}</p>

{% endif %}
<hr>
<ul>
    <li>Created by <a href="{{ url_for('user.profile', username=entry.created_by.username) }}">{{ entry.created_by.username }}</a> ({{ entry.created }})</li>
    {% if entry.edited_by %}
    <li>Edited by <a href="{{ url_for('user.profile', username=entry.edited_by.username) }}">{{ entry.edited_by.username }}</a> ({{ entry.edited }})</li>
    {% endif %}
</ul>
{% endblock %}