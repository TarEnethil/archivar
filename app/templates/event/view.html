{% extends "base.html" %}
{% import 'bootstrap/wtf.html' as wtf %}

{% block scripts %}
{{ super() }}
{% if event.description %}
{{ include_js(['marked']) }}

<script>
    options = {
        sanitize: true
    }

    var desc = document.getElementById('description')
    desc.innerHTML = marked(desc.innerHTML, options);
</script>
{% endif %}
{% endblock %}

{% block app_content %}
    <h1>{{ event.name }}</h1>

    <ul class="nav nav-tabs">
        <li>
            <a href="{{ url_for('event.edit', id=event.id) }}">
                <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                Edit
            </a>
        </li>
    </ul>

    <dl class="dl-horizontal">
        <dt>Category</dt>
        <dd><a href="{{ url_for('event.list_category', c_id=event.category.id) }}" style="padding-left:10px;border-left:7px solid {{ event.category.color }}">{{ event.category.name }}</a></dd>
        <dt>Date</dt>
        <dd>{{ event.start_date(False, with_link=True, with_weekday=True)|safe }}</dd>
        {% if event.duration > 1 %}
        <dt>Duration</dt>
        <dd>{{ event.duration }} days

        {% if event.duration > 1 %}
        (until {{ event.end_date(False, with_link=True, with_weekday=False)|safe }})
        {% endif %}
        </dd>
        {% endif %}
    </dl>

{% if event.description %}
{% if current_user.phb_calendar %}
    <p id="description" class="custom-markdown phb-style">
{% else %}
    <p id="description" class="custom-markdown">
{% endif %}
{{ event.description }}
    </p>
{% endif %}

{% if moons %}
    <h2>Moons on this day</h2>
    <div id="moons">
{% for moon in moons %}
    {{ moon.print_phase(event.timestamp, 100, True)|safe }}
{% endfor %}
    </div>
{% endif %}

    <hr>

    <ul class="list-unstyled">
        <li>Created by: <a href="{{ url_for('user.profile', username=event.created_by.username) }}">{{ event.created_by.username }}</a></li>
        {% if event.edited_by %}
        <li>Edited by: <a href="{{ url_for('user.profile', username=event.edited_by.username) }}">{{ event.edited_by.username }}</a></li>
        {% endif %}
    </ul>
{% endblock %}